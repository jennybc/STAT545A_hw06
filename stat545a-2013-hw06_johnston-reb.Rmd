```{r include = FALSE}
## This .rmd file serves as an HTML report to visualise my data analysis
## procedure

# opts_chunk$set(tidy = FALSE)
source("01_clean_GTD.R")
library(ggplot2) # for graphing
library(plyr) # for data aggregation
library(reshape) # for converting data from wide to tall format for plotting
library(xtable) # for making tables in HTML format
```

STAT545A hw06: Analysis of the Global Terrorism Database
---
_Rebecca Johnston_

_21/10/2013_

I have chosen to complete my final Exploratory Data Analysis assignment using the Global Terrorism Database (GTD), available for download [here](http://www.start.umd.edu/gtd/). The GTD includes over 100 000 incidents of terrorism from 1970 to 2011 (N.B. Incidents of terrorism from year 1993 are not present in the GTD as they were lost).

Here I will display the figures generated by my analysis pipeline using R and the graphical package ggplot2. For my full code, and access to the data used herein, please visit my [github repo](https://github.com/rebjoh/STAT545A_hw06).

Since there are over 100 variables in the GTD, I immediately restricted my analyses to 15 variables for the purposes of this assignment. In addition, I shortened some region names for ease of graphing, so here "MENA" means Middle East and North Africa.

<br />

### Total fatalities and total wounded per incident over time?

First, I want to explore the total number of fatalities per incident over time using a scatter plot:

```{r fig.width = 9, fig.height = 9, fig.align = 'center', echo = FALSE}
killPerYr <- ggplot(terr, aes(x = iyear, y = nkill, na.rm = TRUE)) + 
  ylab("Number of fatalities") +
  xlab("Year") +
  ggtitle("Number of fatalities per terrorist incident over time") +
  theme(plot.title = element_text(face = "bold")) +
  scale_y_continuous(limits = c(0, 450)) + 
  geom_point(na.rm = TRUE, alpha = 0.25)
killPerYr
```

> N.B. I have deliberately chosen not to show extreme outliers by manually specifying the y axis limits. Here, the extreme outliers are the September 11 attacks (2001) which were counted in the GTD as two separate incidents, each with 1381.5 fatalities.

The majority of terrorist incidents have a low number of fatalities, and I have added transparency to the points (which represent incidents) to convey this. 

Initially, it appears that this graph may be suitable as a boxplot, but the inter-quartile range is 1, so that would not be appropriate to graph given the spread of the data.

```{r}
summary(terr$nkill)
```

Since there are so many incidents to convey on the one plot, we could introduce the ggplot2 function *facet_wrap* to separate the fatalities by region:

```{r fig.width = 9, fig.height = 9, fig.align = 'center', echo = FALSE}
killPerYrReg <- ggplot(terr, aes(x = iyear, y = nkill, colour = region_txt, 
                              na.rm = TRUE)) + 
  ylab("Number of fatalities") +
  xlab("Year") +
  ggtitle("Number of fatalities per terrorist incident over time") +
  theme(plot.title = element_text(face = "bold"), 
        axis.text.x = element_text(angle = 90, vjust = 0.25), 
        legend.position = "none") +
  scale_y_continuous(limits = c(0, 450)) + 
  geom_point(na.rm = TRUE, alpha = 0.5, size = I(1)) + 
  facet_wrap(~region_txt)
killPerYrReg
```

Now we can observe that some regions have very low total numbers of fatalities per terrorist incident (e.g. Oceania and Central Asia), whilst other regions have quite a spread in the number of fatalities per incident (e.g. Sub-Saharan Africa and MENA). Let's compare this result to the number of individuals *wounded* per incident over time by region:

```{r fig.width = 9, fig.height = 9, fig.align = 'center', echo = FALSE}
woundPerYrReg <- ggplot(terr, aes(x = iyear, y = nwound, colour = region_txt, 
                                 na.rm = TRUE)) + 
  ylab("Number of individuals wounded") +
  xlab("Year") +
  ggtitle("Number of individuals wounded per terrorist incident over time") +
  theme(plot.title = element_text(face = "bold"), 
        axis.text.x = element_text(angle = 90, vjust = 0.25), 
        legend.position = "none") +
  scale_y_continuous(limits = c(0, 450)) + 
  geom_point(na.rm = TRUE, alpha = 0.5, size = I(1)) + 
  facet_wrap(~region_txt)
woundPerYrReg
```

The differences between the number of fatalities and number of individuals wounded by region appear to be subtle, but let's compare the two variables properly by plotting the data on the same graph. To do this, I used data aggregation to find the total number of fatalities and the total number of individuals wounded by year and region. I then reshaped the data into tall format to allow group in ggplot2:

```{r echo = FALSE}
totKill <- ddply(terr, iyear ~ region_txt, summarize, 
                 nkill = sum(nkill, na.rm = TRUE), 
                 nwound = sum(nwound, na.rm = TRUE))
totKill <- melt(totKill, id = c("iyear", "region_txt"))
names(totKill) <- c("Year", "Region", "Result", "Number")
levels(totKill$Result) <- c("Killed", "Wounded")
```

```{r fig.width = 9, fig.height = 9, fig.align = 'center', echo = FALSE}
kilWndYrReg <- ggplot(totKill, aes(x = Year, y = Number, group = Result, 
                             colour = Result)) +
  geom_line() + facet_wrap(~Region) + 
  ylab("Number of individuals") +
  xlab("Year") +
  ggtitle("Total number of fatalities and wounded individuals per year") +
  theme(plot.title = element_text(face = "bold"), 
        axis.text.x = element_text(angle = 90, vjust = 0.25))
kilWndYrReg
```


So yes, for the most part, the total number of fatalities and the total number of individuals harmed follow a similar trend over time by region. However, one striking deviation from this trend was during 1980-1985 in Central America, where there was a maximum of ~5000 fatalities but no where near as many individuals harmed.

<br />

### Maximum number of fatalities per region for any one incident?

What about the observed outliers, what was the maximum number of fatalities per region for any one incident?

```{r echo=FALSE}
maxKilReg <- ddply(terr, ~region_txt, summarize, 
                    maxKill = max(nkill, na.rm = TRUE))
maxKilReg <- arrange(maxKilReg, maxKill)
maxKilReg <- within(maxKilReg, region_txt <- reorder(region_txt, maxKill))
```

```{r results='asis', echo=FALSE}
maxKilRegXT <- xtable(maxKilReg)
print(maxKilRegXT, type = "html", include.rownames = FALSE)
```

```{r fig.width = 8, fig.height = 8, fig.align = 'center', echo = FALSE}
ggmaxKilReg <- ggplot(maxKilReg, aes(x = region_txt, y = maxKill, 
                                     fill = region_txt)) + 
  coord_flip() +
  geom_histogram(stat = "identity", show_guide = FALSE) +
  ylab("Number of individuals") +
  xlab("Year") +
  ggtitle("Maximum fatalities for any one terrorist incident") +
  theme(plot.title = element_text(face = "bold"), legend.position = "none")
ggmaxKilReg
```

The terrorist incident with the most number of casualties occurred in North America (this was 9/11). Which terrorist groups were behind the attacks with the most fatalities per region?

```{r echo = FALSE}
whichGrp <- function(x) {
  maxKill <- which.max(x$nkill)
  data.frame(maxKill = x[maxKill, "nkill"], 
             x[maxKill,'gname'])
}
maxKilRegGrp <- ddply(terr, ~region_txt, whichGrp)
maxKilRegGrp <- arrange(maxKilRegGrp, maxKill)
names(maxKilRegGrp) <- c("Region", "Max killed", "Terrorist group name")
```

```{r results='asis', echo=FALSE}
maxKilRegGrpXT <- xtable(maxKilRegGrp)
print(maxKilRegGrpXT, type = "html", include.rownames = FALSE)
```

<br />

### How many fatalities are attributed to terrorist attacks each year?

```{r echo = FALSE}
nKillYr <- ddply(terr, ~iyear, summarize, TotalKill = sum(nkill, na.rm = TRUE))
```

```{r fig.width = 9, fig.height = 9, fig.align = 'center', echo = FALSE}
ggnKillYr <- ggplot(nKillYr, aes(x = iyear, y = TotalKill)) + 
  geom_histogram(stat = "identity") +
  ylab("Number of fatalities") +
  xlab("Year") +
  theme(plot.title = element_text(face = "bold")) +
  ggtitle("Total number of fatalities attributed to terrorist attacks per year")
ggnKillYr
```

<br />

### Total number of fatalities per attack type from 1970-2011?

```{r echo = FALSE}
killByAtt <- ddply(terr, ~attacktype1_txt, summarize, 
                   totalKill = sum(nkill, na.rm = TRUE))
# Reorder levels based on minimum of totalKill
killByAtt <- within(killByAtt, attacktype1_txt <- reorder(attacktype1_txt, 
                                                          as.integer(totalKill), 
                                                          FUN = min))
```

```{r fig.width = 8, fig.height = 8, fig.align = 'center', echo = FALSE}
ggkillByAtt <- ggplot(killByAtt, aes(x = attacktype1_txt, y = totalKill, 
                                     fill = attacktype1_txt)) + 
  geom_histogram(stat = "identity") + 
  coord_flip() +
  ylab("Number of fatalities") +
  xlab("Attack type") +
  theme(plot.title = element_text(face = "bold"), legend.position = "none") +
  ggtitle("Total fatalities per terrorist attack type")
ggkillByAtt
```
